#!/bin/bash

set -euo pipefail

echo "Generating LDIF"
echo "Domain: ${LDAP_DOMAIN}"

ORG="$(echo "${LDAP_DOMAIN}" | sed 's/\..*$//')"
TLD="$(echo "${LDAP_DOMAIN}" | sed 's/^.*\.//')"

echo "ORG: ${ORG}"
echo "TLD: ${TLD}"

for filename in /container/templates/; do
    echo "Building ${filename}"

    sed -i "s/\$\{ORG\}/${ORG}/" "${filename}"
    sed -i "s/\$\{ORG\}/${TLD}/" "${filename}"

    cp "${filename}" "/container/service/slapd/assets/config/bootstrap/ldif/"
done

/container/tool/run
